# エニグママシンの仕組み

## エニグママシンとは

エニグママシン（Enigma Machine）は、20世紀初頭にドイツで開発された回転式暗号機です。第二次世界大戦中にドイツ軍によって軍事通信の暗号化に使用され、その解読が戦争の行方に大きな影響を与えました。

## 基本構造

エニグママシンは以下の主要部品から構成されています：

### 1. キーボード（Keyboard）
- 26個のアルファベットキーを配置
- オペレーターが暗号化したい文字を入力する部分
- ドイツ語配列（QWERTZ）を使用

### 2. プラグボード（Plugboard/Steckerbrett）
- 機械の前面に配置された26個のソケット
- ケーブルで任意の2文字をペアにして接続
- 最大13組のペアを作成可能
- 第一段階の暗号化を実行

### 3. ローター（Rotors）
- 円盤状の回転する暗号化装置
- 通常3個（後期型では4個）のローターを使用
- 各ローターには26個の接点があり、内部配線によって文字を置換
- 毎回の入力で右端のローターが1ステップ回転
- オドメーター方式で左隣のローターも回転

#### ローターの種類
- **ローターI**: 配線パターンとノッチ位置が固定
- **ローターII**: 異なる配線パターンを持つ
- **ローターIII**: さらに異なる配線パターン
- **ローターIV, V**: 後期に追加されたローター

#### ローターの回転メカニズム
- **ステッピング**: 右端のローターは毎回1ステップ回転
- **ダブルステッピング**: 中央ローターがノッチ位置にある時の特殊動作
- **ノッチ**: 各ローターに設定された特定位置で隣のローターを回転させる

### 4. リフレクター（Reflector/Umkehrwalze）
- ローターの左端に配置された固定暗号盤
- 入力信号を必ず異なる文字に変換して反射
- 同じ文字を自分自身に暗号化することを防ぐ
- 暗号化と復号化が同一処理になる仕組みを提供

#### リフレクターの種類
- **リフレクターB**: 標準的な配線パターン
- **リフレクターC**: 異なる配線パターンを持つ代替版

### 5. ランプボード（Lampboard）
- 暗号化結果を表示するライト付きの文字盤
- 入力文字に対応する暗号化された文字のランプが点灯
- オペレーターがこの点灯を見て暗号文を記録

## 暗号化の流れ

1. **キーボード入力**: オペレーターが文字キーを押下
2. **プラグボード変換（第1段階）**: 設定されたケーブル接続により文字を変換
3. **ローター回転**: 右端のローターが1ステップ回転（ダブルステッピングの場合は複数回転）
4. **ローター順方向処理**: 右から左へ3つのローターを通過し、各段階で文字を変換
5. **リフレクター処理**: 最左端で文字を反射
6. **ローター逆方向処理**: 左から右へ3つのローターを逆方向に通過し、各段階で逆変換
7. **プラグボード変換（第2段階）**: 再度プラグボード設定により文字を変換
8. **ランプ点灯**: 最終的な暗号化文字のランプが点灯

## 暗号強度の源泉

### 1. 組み合わせの膨大さ
- ローターの順序: 3つのローターを5つから選択 = 60通り
- 初期位置: 各ローター26位置 = 17,576通り
- リング設定: 各ローター26設定 = 17,576通り
- プラグボード: 最大13組の組み合わせ = 約150兆通り

### 2. 動的な暗号化
- 毎回の入力でローターが回転するため、同じ文字でも異なる暗号文となる
- 長文でも繰り返しパターンが現れにくい

### 3. 相互暗号化
- 暗号化と復号化が同一の処理
- 送信者と受信者が同じ設定で操作可能

## エニグマの弱点

### 1. 自己暗号化の禁止
- リフレクターの仕組みにより、文字が自分自身に暗号化されることがない
- 暗号解読の手がかりとなった

### 2. ダブルステッピング
- 特定の条件下で予測可能な回転パターンが発生
- 解読者が内部構造を推測する手がかりとなった

### 3. 運用上の問題
- オペレーターの設定ミスや運用規則の不備
- 暗号文の定型的な始まりや終わり（cribs）の存在

## 歴史的意義

エニグママシンの解読（ウルトラ作戦）は以下の技術革新を生み出しました：

- **コロッサス**: 世界初のプログラム可能な電子計算機
- **ボンべ**: アラン・チューリングが設計した暗号解読機
- **現代暗号学**: コンピュータ時代の暗号理論の基礎

## 参考資料

- [Enigma machine - Wikipedia](https://en.wikipedia.org/wiki/Enigma_machine)  
- [How did the Enigma Machine work? - Brilliant.org](https://brilliant.org/wiki/enigma-machine/)
- [The Enigma machine: How Alan Turing and his colleagues cracked Nazi Germany's secret code](https://www.bbc.co.uk/bitesize/articles/z48ygdm)
- [Crypto Museum - Enigma](https://www.cryptomuseum.com/crypto/enigma/)
- 『エニグマ暗号機の秘密』サイモン・シン著
- 『コード・ブレーカー』ウォルター・アイザクソン著